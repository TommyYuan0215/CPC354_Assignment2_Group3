<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL Hierarchical Cube</title>
    <script type="text/javascript" src="Common/webgl-utils.js"></script>
    <script type="text/javascript" src="Common/initShaders.js"></script>
    <script type="text/javascript" src="Common/MV.js"></script>
</head>
<body>
    <canvas id="webgl-canvas" width="500" height="500"></canvas>

    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec4 vPosition;
        attribute vec4 vColor;
        uniform mat4 modelViewMatrix;
        varying vec4 fColor;

        void main() {
            gl_Position = modelViewMatrix * vPosition;
            fColor = vColor;
        }
    </script>
    
    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;
        varying vec4 fColor;

        void main() {
            gl_FragColor = fColor;
        }
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const canvas = document.getElementById('webgl-canvas');
            const gl = WebGLUtils.setupWebGL(canvas);

            if (!gl) {
                console.error('Unable to initialize WebGL. Your browser may not support it.');
                return;
            }

            const program = initShaders(gl, 'vertex-shader', 'fragment-shader');
            gl.useProgram(program);

            const positionBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);

            // Vertices for the root cube
            const rootCubeVertices = new Float32Array([
                -0.5, -0.5, -0.5,
                 0.5, -0.5, -0.5,
                 0.5,  0.5, -0.5,
                -0.5,  0.5, -0.5,
            ]);

            gl.bufferData(gl.ARRAY_BUFFER, rootCubeVertices, gl.STATIC_DRAW);

            const positionAttributeLocation = gl.getAttribLocation(program, 'vPosition');
            gl.vertexAttribPointer(positionAttributeLocation, 3, gl.FLOAT, false, 0, 0);
            gl.enableVertexAttribArray(positionAttributeLocation);

            const colorBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);

            

            const modelViewMatrix = mat4();
            const modelViewMatrixLocation = gl.getUniformLocation(program, 'modelViewMatrix');
            gl.uniformMatrix4fv(modelViewMatrixLocation, false, flatten(modelViewMatrix));

            gl.clearColor(0.8, 0.8, 0.8, 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

            gl.enable(gl.DEPTH_TEST);

            // Render the root cube
            gl.drawArrays(gl.TRIANGLE_STRIP, 0, rootCubeVertices.length / 3);


        });
    </script>
</body>
</html>
